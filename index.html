<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Sholat Indonesia | Futuristik</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-hijri/2.1.2/moment-hijri.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3b82f6;
            --secondary: #10b981;
            --dark: #1e293b;
            --light: #f8fafc;
        }

        .dark {
            --primary: #60a5fa;
            --secondary: #34d399;
            --dark: #f8fafc;
            --light: #1e293b;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px var(--primary); }
            50% { box-shadow: 0 0 20px var(--primary); }
            100% { box-shadow: 0 0 5px var(--primary); }
        }

        .floating {
            animation: float 6s ease-in-out infinite;
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .glow {
            animation: glow 3s ease-in-out infinite;
        }

        .neon-text {
            text-shadow: 0 0 5px var(--primary), 0 0 10px var(--primary), 0 0 15px var(--primary);
        }

        .neon-border {
            box-shadow: 0 0 5px var(--primary), 0 0 10px var(--primary), inset 0 0 5px var(--primary);
        }

        .particle {
            position: absolute;
            background-color: var(--primary);
            border-radius: 50%;
            pointer-events: none;
            z-index: -1;
        }

        .gradient-bg {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .time-progress {
            height: 4px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            transition: width 0.5s ease;
        }

        .prayer-active {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--primary);
            background-color: rgba(59, 130, 246, 0.2);
        }

        .dark .prayer-active {
            background-color: rgba(59, 130, 246, 0.4);
        }

        .hijri-date {
            font-feature-settings: "ss01";
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300 min-h-screen">
    <!-- Particle Background -->
    <div id="particles-js"></div>

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold neon-text">Jadwal Sholat</h1>
                <p class="text-sm md:text-base opacity-80">Indonesia - Futuristik</p>
            </div>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full glass-effect hover:bg-opacity-30 transition">
                    <i class="fas fa-moon dark:hidden"></i>
                    <i class="fas fa-sun hidden dark:block"></i>
                </button>
                <button id="location-btn" class="p-2 rounded-full glass-effect hover:bg-opacity-30 transition">
                    <i class="fas fa-location-arrow"></i>
                </button>
            </div>
        </header>

        <!-- Current Time and Date -->
        <div class="glass-effect rounded-2xl p-6 mb-8 relative overflow-hidden">
            <div class="absolute inset-0 gradient-bg opacity-10"></div>
            <div class="relative z-10">
                <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                    <div>
                        <h2 id="current-time" class="text-4xl md:text-6xl font-bold mb-2 neon-text">00:00:00</h2>
                        <p id="current-date" class="text-lg opacity-90">Senin, 1 Januari 2023</p>
                        <p id="hijri-date" class="text-sm opacity-80 hijri-date">1 Muharram 1445 H</p>
                    </div>
                    <div class="mt-4 md:mt-0">
                        <div class="text-center glass-effect rounded-xl p-4">
                            <p class="text-sm opacity-80">Waktu Sholat Saat Ini</p>
                            <p id="current-prayer" class="text-2xl font-bold neon-text">-</p>
                        </div>
                    </div>
                </div>
                <div class="time-progress" id="time-progress"></div>
            </div>
        </div>

        <!-- Location Selector -->
        <div class="glass-effect rounded-2xl p-6 mb-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div class="flex-1">
                    <label for="province" class="block text-sm font-medium mb-1">Provinsi</label>
                    <select id="province" class="w-full p-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <option value="">Pilih Provinsi</option>
                    </select>
                </div>
                <div class="flex-1">
                    <label for="city" class="block text-sm font-medium mb-1">Kota/Kabupaten</label>
                    <select id="city" class="w-full p-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" disabled>
                        <option value="">Pilih Kota/Kabupaten</option>
                    </select>
                </div>
                <div class="flex items-end">
                    <button id="search-btn" class="w-full md:w-auto px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition flex items-center justify-center gap-2">
                        <i class="fas fa-search"></i>
                        <span>Cari</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Prayer Times -->
        <div class="glass-effect rounded-2xl p-6 mb-8">
            <h2 class="text-2xl font-bold mb-6 neon-text">Jadwal Sholat Hari Ini</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4" id="prayer-times-container">
                <!-- Prayer times will be loaded here -->
                <div class="text-center p-4 rounded-xl transition-all duration-300">
                    <div class="text-2xl mb-2"><i class="fas fa-moon"></i></div>
                    <h3 class="font-bold mb-1">Subuh</h3>
                    <p class="text-lg">-:-</p>
                </div>
                <div class="text-center p-4 rounded-xl transition-all duration-300">
                    <div class="text-2xl mb-2"><i class="fas fa-sun"></i></div>
                    <h3 class="font-bold mb-1">Dzuhur</h3>
                    <p class="text-lg">-:-</p>
                </div>
                <div class="text-center p-4 rounded-xl transition-all duration-300">
                    <div class="text-2xl mb-2"><i class="fas fa-cloud-sun"></i></div>
                    <h3 class="font-bold mb-1">Ashar</h3>
                    <p class="text-lg">-:-</p>
                </div>
                <div class="text-center p-4 rounded-xl transition-all duration-300">
                    <div class="text-2xl mb-2"><i class="fas fa-sun"></i></div>
                    <h3 class="font-bold mb-1">Maghrib</h3>
                    <p class="text-lg">-:-</p>
                </div>
                <div class="text-center p-4 rounded-xl transition-all duration-300">
                    <div class="text-2xl mb-2"><i class="fas fa-moon"></i></div>
                    <h3 class="font-bold mb-1">Isya</h3>
                    <p class="text-lg">-:-</p>
                </div>
                <div class="text-center p-4 rounded-xl transition-all duration-300">
                    <div class="text-2xl mb-2"><i class="fas fa-sun"></i></div>
                    <h3 class="font-bold mb-1">Terbit</h3>
                    <p class="text-lg">-:-</p>
                </div>
            </div>
        </div>

        <!-- Next Prayer Countdown -->
        <div class="glass-effect rounded-2xl p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4 neon-text">Waktu Menuju Sholat Berikutnya</h2>
            <div class="text-center">
                <div id="countdown" class="text-4xl md:text-5xl font-bold mb-2 neon-text">-:-:-</div>
                <p id="next-prayer-name" class="text-lg opacity-90">-</p>
            </div>
        </div>

        <!-- Additional Info -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
            <div class="glass-effect rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4 neon-text">Info Tambahan</h2>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="opacity-80">Arah Kiblat</span>
                        <span class="font-medium">65.5° Barat Laut</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="opacity-80">Durasi Siang</span>
                        <span class="font-medium" id="day-duration">- jam - menit</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="opacity-80">Durasi Malam</span>
                        <span class="font-medium" id="night-duration">- jam - menit</span>
                    </div>
                </div>
            </div>
            <div class="glass-effect rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4 neon-text">Jadwal Besok</h2>
                <div class="grid grid-cols-3 gap-3">
                    <div>
                        <p class="text-sm opacity-80">Subuh</p>
                        <p class="font-medium" id="tomorrow-fajr">-:-</p>
                    </div>
                    <div>
                        <p class="text-sm opacity-80">Dzuhur</p>
                        <p class="font-medium" id="tomorrow-dhuhr">-:-</p>
                    </div>
                    <div>
                        <p class="text-sm opacity-80">Ashar</p>
                        <p class="font-medium" id="tomorrow-asr">-:-</p>
                    </div>
                    <div>
                        <p class="text-sm opacity-80">Maghrib</p>
                        <p class="font-medium" id="tomorrow-maghrib">-:-</p>
                    </div>
                    <div>
                        <p class="text-sm opacity-80">Isya</p>
                        <p class="font-medium" id="tomorrow-isha">-:-</p>
                    </div>
                    <div>
                        <p class="text-sm opacity-80">Terbit</p>
                        <p class="font-medium" id="tomorrow-sunrise">-:-</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center py-6 opacity-70 text-sm">
            <p>© 2023 Jadwal Sholat Indonesia - Futuristik</p>
            <p class="mt-1">Data dari <a href="https://api.myquran.com/" target="_blank" class="text-blue-500 hover:underline">myQuran API</a></p>
        </footer>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 transition-opacity duration-300">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-white text-xl">Memuat data...</p>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-10 opacity-0 transition-all duration-300 z-50">
        <div class="flex items-center gap-2">
            <i class="fas fa-info-circle"></i>
            <span id="toast-message">Pesan notifikasi</span>
        </div>
    </div>

    <script>
        // DOM Elements
        const themeToggle = document.getElementById('theme-toggle');
        const loadingOverlay = document.getElementById('loading-overlay');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        const provinceSelect = document.getElementById('province');
        const citySelect = document.getElementById('city');
        const searchBtn = document.getElementById('search-btn');
        const locationBtn = document.getElementById('location-btn');
        const currentTimeEl = document.getElementById('current-time');
        const currentDateEl = document.getElementById('current-date');
        const hijriDateEl = document.getElementById('hijri-date');
        const currentPrayerEl = document.getElementById('current-prayer');
        const timeProgressEl = document.getElementById('time-progress');
        const prayerTimesContainer = document.getElementById('prayer-times-container');
        const countdownEl = document.getElementById('countdown');
        const nextPrayerNameEl = document.getElementById('next-prayer-name');
        const dayDurationEl = document.getElementById('day-duration');
        const nightDurationEl = document.getElementById('night-duration');
        
        // Tomorrow's prayer elements
        const tomorrowFajrEl = document.getElementById('tomorrow-fajr');
        const tomorrowDhuhrEl = document.getElementById('tomorrow-dhuhr');
        const tomorrowAsrEl = document.getElementById('tomorrow-asr');
        const tomorrowMaghribEl = document.getElementById('tomorrow-maghrib');
        const tomorrowIshaEl = document.getElementById('tomorrow-isha');
        const tomorrowSunriseEl = document.getElementById('tomorrow-sunrise');

        // Global Variables
        let currentLocation = null;
        let prayerTimes = null;
        let tomorrowPrayerTimes = null;
        let provinces = [];
        let cities = [];
        let activePrayerIndex = -1;
        let nextPrayerIndex = -1;
        let countdownInterval = null;
        let timeUpdateInterval = null;
        let particlesInterval = null;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Check for saved theme preference
            if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }

            // Load provinces
            loadProvinces();

            // Set up event listeners
            setupEventListeners();

            // Start time updates
            updateTime();
            timeUpdateInterval = setInterval(updateTime, 1000);

            // Create floating particles
            createParticles();

            // Try to get user's location
            getUserLocation();
        });

        // Set up event listeners
        function setupEventListeners() {
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);

            // Location search
            provinceSelect.addEventListener('change', loadCities);
            searchBtn.addEventListener('click', searchPrayerTimes);

            // Get current location
            locationBtn.addEventListener('click', getUserLocation);
        }

        // Toggle between light and dark theme
        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        }

        // Show loading overlay
        function showLoading() {
            loadingOverlay.classList.remove('opacity-0');
            loadingOverlay.classList.add('opacity-100');
        }

        // Hide loading overlay
        function hideLoading() {
            loadingOverlay.classList.remove('opacity-100');
            loadingOverlay.classList.add('opacity-0');
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
            }, 300);
        }

        // Show toast notification
        function showToast(message, duration = 3000) {
            toastMessage.textContent = message;
            toast.classList.remove('translate-y-10', 'opacity-0');
            toast.classList.add('translate-y-0', 'opacity-100');
            
            setTimeout(() => {
                toast.classList.remove('translate-y-0', 'opacity-100');
                toast.classList.add('translate-y-10', 'opacity-0');
            }, duration);
        }

        // Load provinces data
        async function loadProvinces() {
            showLoading();
            try {
                const response = await fetch('https://api.myquran.com/v1/sholat/kocok');
                const data = await response.json();
                
                if (data.status && data.data) {
                    provinces = data.data;
                    provinces.sort((a, b) => a.localeCompare(b));
                    
                    // Populate province select
                    provinceSelect.innerHTML = '<option value="">Pilih Provinsi</option>';
                    provinces.forEach(province => {
                        const option = document.createElement('option');
                        option.value = province;
                        option.textContent = province;
                        provinceSelect.appendChild(option);
                    });
                    
                    hideLoading();
                } else {
                    throw new Error('Gagal memuat data provinsi');
                }
            } catch (error) {
                console.error('Error loading provinces:', error);
                hideLoading();
                showToast('Gagal memuat data provinsi');
            }
        }

        // Load cities data based on selected province
        async function loadCities() {
            const province = provinceSelect.value;
            if (!province) return;
            
            showLoading();
            citySelect.disabled = true;
            citySelect.innerHTML = '<option value="">Pilih Kota/Kabupaten</option>';
            
            try {
                const response = await fetch(`https://api.myquran.com/v1/sholat/kota/cari/${encodeURIComponent(province)}`);
                const data = await response.json();
                
                if (data.status && data.data) {
                    cities = data.data;
                    cities.sort((a, b) => a.lokasi.localeCompare(b.lokasi));
                    
                    // Populate city select
                    cities.forEach(city => {
                        const option = document.createElement('option');
                        option.value = city.id;
                        option.textContent = city.lokasi;
                        citySelect.appendChild(option);
                    });
                    
                    citySelect.disabled = false;
                    hideLoading();
                } else {
                    throw new Error('Gagal memuat data kota');
                }
            } catch (error) {
                console.error('Error loading cities:', error);
                hideLoading();
                showToast('Gagal memuat data kota');
            }
        }

        // Get user's current location
        function getUserLocation() {
            if (navigator.geolocation) {
                showLoading();
                showToast('Mencoba mendapatkan lokasi Anda...');
                
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        try {
                            const { latitude, longitude } = position.coords;
                            const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=id`);
                            const data = await response.json();
                            
                            if (data.city) {
                                // Try to find matching city in our data
                                const cityName = data.city.replace('Kota ', '').replace('Kabupaten ', '');
                                const provinceName = data.principalSubdivision;
                                
                                // Set province
                                const provinceOption = Array.from(provinceSelect.options).find(opt => 
                                    opt.text.includes(provinceName)
                                );
                                
                                if (provinceOption) {
                                    provinceSelect.value = provinceOption.value;
                                    await loadCities();
                                    
                                    // Find matching city
                                    const cityOption = Array.from(citySelect.options).find(opt => 
                                        opt.text.includes(cityName)
                                    );
                                    
                                    if (cityOption) {
                                        citySelect.value = cityOption.value;
                                        searchPrayerTimes();
                                    } else {
                                        showToast('Lokasi tidak ditemukan, silakan pilih manual');
                                    }
                                } else {
                                    showToast('Lokasi tidak ditemukan, silakan pilih manual');
                                }
                            } else {
                                showToast('Gagal mendapatkan lokasi, silakan pilih manual');
                            }
                        } catch (error) {
                            console.error('Error getting location:', error);
                            showToast('Gagal mendapatkan lokasi, silakan pilih manual');
                        } finally {
                            hideLoading();
                        }
                    },
                    (error) => {
                        console.error('Geolocation error:', error);
                        hideLoading();
                        showToast('Akses lokasi ditolak, silakan pilih manual');
                    }
                );
            } else {
                showToast('Browser tidak mendukung geolocation, silakan pilih manual');
            }
        }

        // Search prayer times based on selected city
        async function searchPrayerTimes() {
            const cityId = citySelect.value;
            if (!cityId) {
                showToast('Silakan pilih kota/kabupaten terlebih dahulu');
                return;
            }
            
            showLoading();
            
            try {
                // Get today's prayer times
                const today = new Date();
                const dateStr = `${today.getFullYear()}/${today.getMonth() + 1}/${today.getDate()}`;
                const response = await fetch(`https://api.myquran.com/v1/sholat/jadwal/${cityId}/${dateStr}`);
                const data = await response.json();
                
                if (data.status && data.data) {
                    currentLocation = data.data.lokasi;
                    prayerTimes = data.data.jadwal;
                    
                    // Get tomorrow's prayer times
                    const tomorrow = new Date(today);
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    const tomorrowDateStr = `${tomorrow.getFullYear()}/${tomorrow.getMonth() + 1}/${tomorrow.getDate()}`;
                    const tomorrowResponse = await fetch(`https://api.myquran.com/v1/sholat/jadwal/${cityId}/${tomorrowDateStr}`);
                    const tomorrowData = await tomorrowResponse.json();
                    
                    if (tomorrowData.status && tomorrowData.data) {
                        tomorrowPrayerTimes = tomorrowData.data.jadwal;
                    }
                    
                    // Update UI
                    updatePrayerTimesUI();
                    startCountdown();
                    
                    showToast(`Jadwal sholat untuk ${currentLocation} dimuat`);
                } else {
                    throw new Error('Gagal memuat jadwal sholat');
                }
            } catch (error) {
                console.error('Error fetching prayer times:', error);
                showToast('Gagal memuat jadwal sholat');
            } finally {
                hideLoading();
            }
        }

        // Update prayer times UI
        function updatePrayerTimesUI() {
            if (!prayerTimes || !tomorrowPrayerTimes) return;
            
            // Update today's prayer times
            const prayers = [
                { name: 'Subuh', time: prayerTimes.subuh, icon: 'fa-moon', key: 'subuh' },
                { name: 'Terbit', time: prayerTimes.terbit, icon: 'fa-sun', key: 'sunrise' },
                { name: 'Dzuhur', time: prayerTimes.dzuhur, icon: 'fa-sun', key: 'dhuhr' },
                { name: 'Ashar', time: prayerTimes.ashar, icon: 'fa-cloud-sun', key: 'asr' },
                { name: 'Maghrib', time: prayerTimes.maghrib, icon: 'fa-sun', key: 'maghrib' },
                { name: 'Isya', time: prayerTimes.isya, icon: 'fa-moon', key: 'isha' }
            ];
            
            // Update tomorrow's prayer times
            tomorrowFajrEl.textContent = tomorrowPrayerTimes.subuh;
            tomorrowDhuhrEl.textContent = tomorrowPrayerTimes.dzuhur;
            tomorrowAsrEl.textContent = tomorrowPrayerTimes.ashar;
            tomorrowMaghribEl.textContent = tomorrowPrayerTimes.maghrib;
            tomorrowIshaEl.textContent = tomorrowPrayerTimes.isya;
            tomorrowSunriseEl.textContent = tomorrowPrayerTimes.terbit;
            
            // Calculate day and night duration
            const sunriseTime = convertTimeToDate(prayerTimes.terbit);
            const sunsetTime = convertTimeToDate(prayerTimes.maghrib);
            
            const dayDurationMs = sunsetTime - sunriseTime;
            const nightDurationMs = (24 * 60 * 60 * 1000) - dayDurationMs;
            
            dayDurationEl.textContent = formatDuration(dayDurationMs);
            nightDurationEl.textContent = formatDuration(nightDurationMs);
            
            // Update prayer times display
            prayerTimesContainer.innerHTML = '';
            prayers.forEach((prayer, index) => {
                const prayerEl = document.createElement('div');
                prayerEl.className = 'text-center p-4 rounded-xl transition-all duration-300 prayer-time';
                prayerEl.dataset.prayer = prayer.key;
                prayerEl.dataset.time = prayer.time;
                
                prayerEl.innerHTML = `
                    <div class="text-2xl mb-2"><i class="fas ${prayer.icon}"></i></div>
                    <h3 class="font-bold mb-1">${prayer.name}</h3>
                    <p class="text-lg">${prayer.time}</p>
                `;
                
                prayerTimesContainer.appendChild(prayerEl);
            });
            
            // Determine current and next prayer
            determineCurrentAndNextPrayer();
        }

        // Convert time string (HH:mm) to Date object
        function convertTimeToDate(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            const date = new Date();
            date.setHours(hours, minutes, 0, 0);
            return date;
        }

        // Format duration in milliseconds to HH:mm
        function formatDuration(ms) {
            const totalMinutes = Math.floor(ms / (1000 * 60));
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            return `${hours} jam ${minutes} menit`;
        }

        // Determine current and next prayer
        function determineCurrentAndNextPrayer() {
            if (!prayerTimes) return;
            
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            const prayerTimesList = [
                { name: 'Subuh', time: prayerTimes.subuh, key: 'subuh' },
                { name: 'Terbit', time: prayerTimes.terbit, key: 'sunrise' },
                { name: 'Dzuhur', time: prayerTimes.dzuhur, key: 'dhuhr' },
                { name: 'Ashar', time: prayerTimes.ashar, key: 'asr' },
                { name: 'Maghrib', time: prayerTimes.maghrib, key: 'maghrib' },
                { name: 'Isya', time: prayerTimes.isya, key: 'isha' }
            ];
            
            // Convert prayer times to minutes since midnight
            const prayerMinutes = prayerTimesList.map(prayer => {
                const [hours, minutes] = prayer.time.split(':').map(Number);
                return {
                    name: prayer.name,
                    key: prayer.key,
                    minutes: hours * 60 + minutes
                };
            });
            
            // Find current and next prayer
            let currentPrayer = null;
            let nextPrayer = null;
            
            for (let i = 0; i < prayerMinutes.length; i++) {
                if (currentTime < prayerMinutes[i].minutes) {
                    nextPrayer = prayerMinutes[i];
                    break;
                }
            }
            
            // If no next prayer found (it's after Isha), next prayer is tomorrow's Fajr
            if (!nextPrayer) {
                nextPrayer = {
                    name: 'Subuh',
                    key: 'subuh',
                    minutes: prayerMinutes[0].minutes + 24 * 60 // Add 24 hours
                };
            }
            
            // Find current prayer (the one before next prayer)
            const nextIndex = prayerMinutes.findIndex(p => p.minutes === nextPrayer.minutes);
            const currentIndex = (nextIndex - 1 + prayerMinutes.length) % prayerMinutes.length;
            currentPrayer = prayerMinutes[currentIndex];
            
            // Check if current time is between current prayer and next prayer
            if (currentTime >= currentPrayer.minutes && currentTime < nextPrayer.minutes) {
                currentPrayerEl.textContent = currentPrayer.name;
                activePrayerIndex = currentIndex;
            } else {
                currentPrayerEl.textContent = '-';
                activePrayerIndex = -1;
            }
            
            nextPrayerIndex = nextIndex;
            nextPrayerNameEl.textContent = nextPrayer.name;
            
            // Highlight active prayer in the UI
            document.querySelectorAll('.prayer-time').forEach(el => {
                el.classList.remove('prayer-active');
            });
            
            if (activePrayerIndex >= 0) {
                const activePrayerEl = document.querySelector(`.prayer-time[data-prayer="${currentPrayer.key}"]`);
                if (activePrayerEl) {
                    activePrayerEl.classList.add('prayer-active');
                    
                    // Calculate progress between current prayer and next prayer
                    const currentPrayerTime = convertTimeToDate(prayerTimesList[activePrayerIndex].time);
                    const nextPrayerTime = convertTimeToDate(prayerTimesList[nextPrayerIndex].time);
                    
                    // Handle case where next prayer is tomorrow (e.g., after Isha)
                    if (nextPrayerTime < currentPrayerTime) {
                        nextPrayerTime.setDate(nextPrayerTime.getDate() + 1);
                    }
                    
                    const totalDuration = nextPrayerTime - currentPrayerTime;
                    const elapsed = now - currentPrayerTime;
                    const progress = (elapsed / totalDuration) * 100;
                    
                    timeProgressEl.style.width = `${Math.min(100, Math.max(0, progress))}%`;
                }
            } else {
                timeProgressEl.style.width = '0%';
            }
        }

        // Start countdown to next prayer
        function startCountdown() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            countdownInterval = setInterval(updateCountdown, 1000);
            updateCountdown();
        }

        // Update countdown display
        function updateCountdown() {
            if (!prayerTimes || nextPrayerIndex === -1) {
                countdownEl.textContent = '-:-:-';
                return;
            }
            
            const now = new Date();
            const prayerTimesList = [
                { time: prayerTimes.subuh },
                { time: prayerTimes.terbit },
                { time: prayerTimes.dzuhur },
                { time: prayerTimes.ashar },
                { time: prayerTimes.maghrib },
                { time: prayerTimes.isya }
            ];
            
            const nextPrayerTimeStr = prayerTimesList[nextPrayerIndex].time;
            const nextPrayerTime = convertTimeToDate(nextPrayerTimeStr);
            
            // If next prayer is tomorrow (e.g., after Isha)
            if (nextPrayerTime < now) {
                nextPrayerTime.setDate(nextPrayerTime.getDate() + 1);
            }
            
            const diffMs = nextPrayerTime - now;
            
            if (diffMs <= 0) {
                // Prayer time has arrived, refresh data
                searchPrayerTimes();
                return;
            }
            
            const diffSeconds = Math.floor(diffMs / 1000);
            const hours = Math.floor(diffSeconds / 3600);
            const minutes = Math.floor((diffSeconds % 3600) / 60);
            const seconds = diffSeconds % 60;
            
            countdownEl.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Update current time and date
        function updateTime() {
            const now = new Date();
            
            // Update time
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            currentTimeEl.textContent = `${hours}:${minutes}:${seconds}`;
            
            // Update date
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            currentDateEl.textContent = now.toLocaleDateString('id-ID', options);
            
            // Update Hijri date
            const hijriDate = moment(now).iDate();
            const hijriMonth = hijriDate.format('iMMMM');
            const hijriYear = hijriDate.format('iYYYY');
            hijriDateEl.textContent = `${hijriDate.format('iD')} ${hijriMonth} ${hijriYear} H`;
            
            // Update prayer times if needed
            if (prayerTimes) {
                determineCurrentAndNextPrayer();
            }
        }

        // Create floating particles effect
        function createParticles() {
            const colors = ['#3b82f6', '#10b981', '#8b5cf6', '#ec4899'];
            
            particlesInterval = setInterval(() => {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Random size
                const size = Math.random() * 5 + 1;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // Random position
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                
                // Random color
                particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                // Random opacity
                particle.style.opacity = Math.random() * 0.5 + 0.1;
                
                // Add to body
                document.body.appendChild(particle);
                
                // Animate particle
                gsap.to(particle, {
                    x: `${(Math.random() - 0.5) * 200}px`,
                    y: `${(Math.random() - 0.5) * 200}px`,
                    opacity: 0,
                    duration: Math.random() * 10 + 5,
                    onComplete: () => {
                        particle.remove();
                    }
                });
            }, 300);
        }

        // Clean up intervals when page is unloaded
        window.addEventListener('beforeunload', () => {
            if (countdownInterval) clearInterval(countdownInterval);
            if (timeUpdateInterval) clearInterval(timeUpdateInterval);
            if (particlesInterval) clearInterval(particlesInterval);
        });
    </script>
</body>
</html>